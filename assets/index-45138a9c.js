var At=Object.defineProperty;var Ct=(d,t,e)=>t in d?At(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var _=(d,t,e)=>(Ct(d,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();var _t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ot;(function(d){(function(t){var e=typeof _t=="object"?_t:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=s(d);typeof e.Reflect>"u"?e.Reflect=d:n=s(e.Reflect,n),t(n);function s(o,c){return function(p,w){typeof o[p]!="function"&&Object.defineProperty(o,p,{configurable:!0,writable:!0,value:w}),c&&c(p,w)}}})(function(t){var e=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",s=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",c=typeof Object.create=="function",p={__proto__:[]}instanceof Array,w=!c&&!p,x={create:c?function(){return $(Object.create(null))}:p?function(){return $({__proto__:null})}:function(){return $({})},has:w?function(i,r){return e.call(i,r)}:function(i,r){return r in i},get:w?function(i,r){return e.call(i,r)?i[r]:void 0}:function(i,r){return i[r]}},S=Object.getPrototypeOf(Function),P=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",T=!P&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Rt(),H=!P&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ot(),G=!P&&typeof WeakMap=="function"?WeakMap:Xt(),I=new G;function q(i,r,h,a){if(v(h)){if(!nt(i))throw new TypeError;if(!rt(r))throw new TypeError;return wt(i,r)}else{if(!nt(i))throw new TypeError;if(!b(r))throw new TypeError;if(!b(a)&&!v(a)&&!R(a))throw new TypeError;return R(a)&&(a=void 0),h=M(h),xt(i,r,h,a)}}t("decorate",q);function L(i,r){function h(a,l){if(!b(a))throw new TypeError;if(!v(l)&&!Et(l))throw new TypeError;tt(i,r,a,l)}return h}t("metadata",L);function F(i,r,h,a){if(!b(h))throw new TypeError;return v(a)||(a=M(a)),tt(i,r,h,a)}t("defineMetadata",F);function j(i,r,h){if(!b(r))throw new TypeError;return v(h)||(h=M(h)),J(i,r,h)}t("hasMetadata",j);function z(i,r,h){if(!b(r))throw new TypeError;return v(h)||(h=M(h)),U(i,r,h)}t("hasOwnMetadata",z);function D(i,r,h){if(!b(r))throw new TypeError;return v(h)||(h=M(h)),Q(i,r,h)}t("getMetadata",D);function gt(i,r,h){if(!b(r))throw new TypeError;return v(h)||(h=M(h)),K(i,r,h)}t("getOwnMetadata",gt);function pt(i,r){if(!b(i))throw new TypeError;return v(r)||(r=M(r)),et(i,r)}t("getMetadataKeys",pt);function mt(i,r){if(!b(i))throw new TypeError;return v(r)||(r=M(r)),it(i,r)}t("getOwnMetadataKeys",mt);function yt(i,r,h){if(!b(r))throw new TypeError;v(h)||(h=M(h));var a=B(r,h,!1);if(v(a)||!a.delete(i))return!1;if(a.size>0)return!0;var l=I.get(r);return l.delete(h),l.size>0||I.delete(r),!0}t("deleteMetadata",yt);function wt(i,r){for(var h=i.length-1;h>=0;--h){var a=i[h],l=a(r);if(!v(l)&&!R(l)){if(!rt(l))throw new TypeError;r=l}}return r}function xt(i,r,h,a){for(var l=i.length-1;l>=0;--l){var k=i[l],f=k(r,h,a);if(!v(f)&&!R(f)){if(!b(f))throw new TypeError;a=f}}return a}function B(i,r,h){var a=I.get(i);if(v(a)){if(!h)return;a=new T,I.set(i,a)}var l=a.get(r);if(v(l)){if(!h)return;l=new T,a.set(r,l)}return l}function J(i,r,h){var a=U(i,r,h);if(a)return!0;var l=N(r);return R(l)?!1:J(i,l,h)}function U(i,r,h){var a=B(r,h,!1);return v(a)?!1:St(a.has(i))}function Q(i,r,h){var a=U(i,r,h);if(a)return K(i,r,h);var l=N(r);if(!R(l))return Q(i,l,h)}function K(i,r,h){var a=B(r,h,!1);if(!v(a))return a.get(i)}function tt(i,r,h,a){var l=B(h,a,!0);l.set(i,r)}function et(i,r){var h=it(i,r),a=N(i);if(a===null)return h;var l=et(a,r);if(l.length<=0)return h;if(h.length<=0)return l;for(var k=new H,f=[],g=0,u=h;g<u.length;g++){var m=u[g],y=k.has(m);y||(k.add(m),f.push(m))}for(var Y=0,at=l;Y<at.length;Y++){var m=at[Y],y=k.has(m);y||(k.add(m),f.push(m))}return f}function it(i,r){var h=[],a=B(i,r,!1);if(v(a))return h;for(var l=a.keys(),k=Pt(l),f=0;;){var g=Yt(k);if(!g)return h.length=f,h;var u=Tt(g);try{h[f]=u}catch(m){try{It(k)}finally{throw m}}f++}}function st(i){if(i===null)return 1;switch(typeof i){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return i===null?1:6;default:return 6}}function v(i){return i===void 0}function R(i){return i===null}function vt(i){return typeof i=="symbol"}function b(i){return typeof i=="object"?i!==null:typeof i=="function"}function bt(i,r){switch(st(i)){case 0:return i;case 1:return i;case 2:return i;case 3:return i;case 4:return i;case 5:return i}var h=r===3?"string":r===5?"number":"default",a=ht(i,s);if(a!==void 0){var l=a.call(i,h);if(b(l))throw new TypeError;return l}return kt(i,h==="default"?"number":h)}function kt(i,r){if(r==="string"){var h=i.toString;if(O(h)){var a=h.call(i);if(!b(a))return a}var l=i.valueOf;if(O(l)){var a=l.call(i);if(!b(a))return a}}else{var l=i.valueOf;if(O(l)){var a=l.call(i);if(!b(a))return a}var k=i.toString;if(O(k)){var a=k.call(i);if(!b(a))return a}}throw new TypeError}function St(i){return!!i}function Mt(i){return""+i}function M(i){var r=bt(i,3);return vt(r)?r:Mt(r)}function nt(i){return Array.isArray?Array.isArray(i):i instanceof Object?i instanceof Array:Object.prototype.toString.call(i)==="[object Array]"}function O(i){return typeof i=="function"}function rt(i){return typeof i=="function"}function Et(i){switch(st(i)){case 3:return!0;case 4:return!0;default:return!1}}function ht(i,r){var h=i[r];if(h!=null){if(!O(h))throw new TypeError;return h}}function Pt(i){var r=ht(i,o);if(!O(r))throw new TypeError;var h=r.call(i);if(!b(h))throw new TypeError;return h}function Tt(i){return i.value}function Yt(i){var r=i.next();return r.done?!1:r}function It(i){var r=i.return;r&&r.call(i)}function N(i){var r=Object.getPrototypeOf(i);if(typeof i!="function"||i===S||r!==S)return r;var h=i.prototype,a=h&&Object.getPrototypeOf(h);if(a==null||a===Object.prototype)return r;var l=a.constructor;return typeof l!="function"||l===i?r:l}function Rt(){var i={},r=[],h=function(){function f(g,u,m){this._index=0,this._keys=g,this._values=u,this._selector=m}return f.prototype["@@iterator"]=function(){return this},f.prototype[o]=function(){return this},f.prototype.next=function(){var g=this._index;if(g>=0&&g<this._keys.length){var u=this._selector(this._keys[g],this._values[g]);return g+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:u,done:!1}}return{value:void 0,done:!0}},f.prototype.throw=function(g){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),g},f.prototype.return=function(g){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:g,done:!0}},f}();return function(){function f(){this._keys=[],this._values=[],this._cacheKey=i,this._cacheIndex=-2}return Object.defineProperty(f.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),f.prototype.has=function(g){return this._find(g,!1)>=0},f.prototype.get=function(g){var u=this._find(g,!1);return u>=0?this._values[u]:void 0},f.prototype.set=function(g,u){var m=this._find(g,!0);return this._values[m]=u,this},f.prototype.delete=function(g){var u=this._find(g,!1);if(u>=0){for(var m=this._keys.length,y=u+1;y<m;y++)this._keys[y-1]=this._keys[y],this._values[y-1]=this._values[y];return this._keys.length--,this._values.length--,g===this._cacheKey&&(this._cacheKey=i,this._cacheIndex=-2),!0}return!1},f.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=i,this._cacheIndex=-2},f.prototype.keys=function(){return new h(this._keys,this._values,a)},f.prototype.values=function(){return new h(this._keys,this._values,l)},f.prototype.entries=function(){return new h(this._keys,this._values,k)},f.prototype["@@iterator"]=function(){return this.entries()},f.prototype[o]=function(){return this.entries()},f.prototype._find=function(g,u){return this._cacheKey!==g&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=g)),this._cacheIndex<0&&u&&(this._cacheIndex=this._keys.length,this._keys.push(g),this._values.push(void 0)),this._cacheIndex},f}();function a(f,g){return f}function l(f,g){return g}function k(f,g){return[f,g]}}function Ot(){return function(){function i(){this._map=new T}return Object.defineProperty(i.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),i.prototype.has=function(r){return this._map.has(r)},i.prototype.add=function(r){return this._map.set(r,r),this},i.prototype.delete=function(r){return this._map.delete(r)},i.prototype.clear=function(){this._map.clear()},i.prototype.keys=function(){return this._map.keys()},i.prototype.values=function(){return this._map.values()},i.prototype.entries=function(){return this._map.entries()},i.prototype["@@iterator"]=function(){return this.keys()},i.prototype[o]=function(){return this.keys()},i}()}function Xt(){var i=16,r=x.create(),h=a();return function(){function u(){this._key=a()}return u.prototype.has=function(m){var y=l(m,!1);return y!==void 0?x.has(y,this._key):!1},u.prototype.get=function(m){var y=l(m,!1);return y!==void 0?x.get(y,this._key):void 0},u.prototype.set=function(m,y){var Y=l(m,!0);return Y[this._key]=y,this},u.prototype.delete=function(m){var y=l(m,!1);return y!==void 0?delete y[this._key]:!1},u.prototype.clear=function(){this._key=a()},u}();function a(){var u;do u="@@WeakMap@@"+g();while(x.has(r,u));return r[u]=!0,u}function l(u,m){if(!e.call(u,h)){if(!m)return;Object.defineProperty(u,h,{value:x.create()})}return u[h]}function k(u,m){for(var y=0;y<m;++y)u[y]=Math.random()*255|0;return u}function f(u){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(u)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(u)):k(new Uint8Array(u),u):k(new Array(u),u)}function g(){var u=f(i);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var m="",y=0;y<i;++y){var Y=u[y];(y===4||y===6||y===8)&&(m+="-"),Y<16&&(m+="0"),m+=Y.toString(16).toLowerCase()}return m}}function $(i){return i.__=void 0,delete i.__,i}})})(ot||(ot={}));class C{constructor(t){_(this,"_id");_(this,"_x");_(this,"_y");_(this,"_w");_(this,"_h");_(this,"_angle");_(this,"_image");_(this,"_speed");_(this,"_isHitted");_(this,"_life");_(this,"_damage");_(this,"_lastPosX");_(this,"_lastSpeed");_(this,"_sx");_(this,"_sy");_(this,"_lastPosY");this._id=10,this._x=0,this._y=0,this._sx=0,this._sy=0,this._lastPosX=this._x,this._lastPosY=this._y,this._w=0,this._h=0,this._angle=0,this._image=t,this._speed=1,this._lastSpeed=this._speed,this._isHitted=!1,this._life=100,this._damage=10}get lastSpeed(){return this._lastSpeed}set lastSpeed(t){this._lastSpeed=t}get lastPosX(){return this._lastPosX}set lastPosX(t){this._lastPosX=t}get lastPosY(){return this._lastPosY}set lastPosY(t){this._lastPosY=t}get id(){return this._id}get x(){return this._x}get y(){return this._y}get w(){return this._w}get h(){return this._h}get angle(){return this._angle}get speed(){return this._speed}set speed(t){this._speed=t}get isHitted(){return this._isHitted}get life(){return this._life}get damage(){return this._damage}set x(t){this._x=t}set y(t){this._y=t}set isHitted(t){this._isHitted=t}set life(t){this._life=t}posX(t){return this._x=t,this}posY(t){return this._y=t,this}setSx(t){return this._sx=t,this}setSy(t){return this._sy=t,this}width(t){return this._w=t,this}height(t){return this._h=t,this}setAngle(t){return this._angle=t,this}setImage(t){return this._image=t,this}setSpeed(t){return this._speed=t,this}setDamage(t){return this._damage=t,this}setLife(t){return this._life=t,this}}class Ht extends C{constructor(e,n){super(e);_(this,"_owner");_(this,"_pivotY");this.image=e,this._camera=n,this._pivotY=this._h}attach(e){this._owner=e,this._x=e.x+e.w/2-this._w/2,this._y=e.y+e.h/2}update(){this._owner&&this.attach(this._owner)}rotate(e,n){if(this._owner){this._x+=Math.cos(this._angle),this._y+=Math.sin(this._angle);const s=e-this._x,o=n-this._y;this._angle=Math.atan2(o,s)}}draw(e){e.save();const n=this._x-this._camera.x,s=this._y-this._camera.y;e.translate(n+this._w/2,s+this._pivotY),e.rotate(this._angle-Math.PI/2),e.translate(-n-this._w/2,-s-this._pivotY),e.drawImage(this.image,this._sx,this._sy,this._w,this._h,n,s,this._w,this._h),e.restore()}}class Gt{constructor(t,e){_(this,"_x");_(this,"_sprite");_(this,"_up");_(this,"_right");_(this,"_left");_(this,"_down");_(this,"_y");_(this,"_centerX");_(this,"_centerY");this._canvasWidth=t,this._canvasHeight=e,this._x=0,this._y=0,this._centerX=this._canvasWidth/2,this._centerY=this._canvasHeight/2,this._up=!1,this._right=!1,this._left=!1,this._down=!1,this._sprite=null,window.addEventListener("keydown",this.keysPressed.bind(this),!1),window.addEventListener("keyup",this.keysReleased.bind(this),!1)}get sprite(){return this._sprite}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._x=t}bind(t){this._sprite=t,this._x=this._sprite.x-this._centerX,this._y=this._sprite.y-this._centerY}update(){this._up?this._y-=10:this._right?this._x+=10:this._down?this._y+=10:this._left?this._x-=10:(this._x=this._sprite.x-this._centerX,this._y=this._sprite.y-this._centerY)}keysPressed(t){switch(t.key){case"ArrowUp":this._up=!0;break;case"ArrowRight":this._right=!0;break;case"ArrowDown":this._down=!0;break;case"ArrowLeft":this._left=!0;break}}keysReleased(t){switch(t.key){case"ArrowUp":this._up=!1;break;case"ArrowRight":this._right=!1;break;case"ArrowDown":this._down=!1;break;case"ArrowLeft":this._left=!1;break}}}class ft extends C{constructor(e,n,s,o){super(e);_(this,"_type");_(this,"_maxRange");this.image=e,this._camera=n,this._firedX=s,this._firedY=o,this._type="hero",this._maxRange=1e3}get maxRange(){return this._maxRange}get type(){return this._type}get damage(){return this._damage}setType(e){return this._type=e,this}rangeLimitReached(){return Math.sqrt((this.x-this._firedX)*(this.x-this._firedX)+(this._y-this._firedY)*(this._y-this._firedY))>this._maxRange}move(){const e=Math.cos(this._angle)*this._speed,n=Math.sin(this._angle)*this._speed;this._x+=e,this._y+=n}update(){this.move()}draw(e){const n=this._x-this._camera.x,s=this._y-this._camera.y,o=this._type==="hero"?this._angle+Math.PI/2:this._angle;e.save(),e.translate(n+this._w/2,s+this._h/2),e.rotate(o),e.translate(-n-this._w/2,-s-this._h/2),e.drawImage(this.image,this._sx,this._sy,this._w,this._h,n,s,this._w,this._h),e.restore()}calculateAngle(e){switch(e){case"hero":return this._angle;case"enemy":return this._angle;default:return this._angle}}}function V(d,t){return d=Math.ceil(d),t=Math.floor(t),Math.floor(Math.random()*(t-d+1)+d)}const Lt={SubTexture:[{_name:"barrelBeige.png",_x:"842",_y:"108",_width:"16",_height:"50"},{_name:"barrelBeige_outline.png",_x:"840",_y:"368",_width:"24",_height:"58"},{_name:"barrelBlack.png",_x:"840",_y:"426",_width:"16",_height:"50"},{_name:"barrelBlack_outline.png",_x:"818",_y:"168",_width:"24",_height:"58"},{_name:"barrelBlue.png",_x:"850",_y:"58",_width:"16",_height:"50"},{_name:"barrelBlue_outline.png",_x:"827",_y:"226",_width:"24",_height:"58"},{_name:"barrelGreen.png",_x:"834",_y:"58",_width:"16",_height:"50"},{_name:"barrelGreen_outline.png",_x:"818",_y:"110",_width:"24",_height:"58"},{_name:"barrelGreen_side.png",_x:"746",_y:"48",_width:"44",_height:"62"},{_name:"barrelGreen_side_damaged.png",_x:"790",_y:"48",_width:"44",_height:"62"},{_name:"barrelGreen_up.png",_x:"746",_y:"0",_width:"48",_height:"48"},{_name:"barrelGrey_sde_rust.png",_x:"783",_y:"244",_width:"44",_height:"62"},{_name:"barrelGrey_side.png",_x:"796",_y:"410",_width:"44",_height:"62"},{_name:"barrelGrey_up.png",_x:"735",_y:"252",_width:"48",_height:"48"},{_name:"barrelRed.png",_x:"842",_y:"158",_width:"16",_height:"50"},{_name:"barrelRed_outline.png",_x:"834",_y:"0",_width:"24",_height:"58"},{_name:"barrelRed_side.png",_x:"805",_y:"306",_width:"44",_height:"62"},{_name:"barrelRed_up.png",_x:"730",_y:"454",_width:"48",_height:"48"},{_name:"bulletBeige.png",_x:"48",_y:"481",_width:"12",_height:"26"},{_name:"bulletBeigeSilver.png",_x:"188",_y:"345",_width:"12",_height:"26"},{_name:"bulletBeigeSilver_outline.png",_x:"671",_y:"140",_width:"20",_height:"34"},{_name:"bulletBeige_outline.png",_x:"128",_y:"345",_width:"20",_height:"34"},{_name:"bulletBlue.png",_x:"0",_y:"481",_width:"12",_height:"26"},{_name:"bulletBlueSilver.png",_x:"12",_y:"481",_width:"12",_height:"26"},{_name:"bulletBlueSilver_outline.png",_x:"148",_y:"345",_width:"20",_height:"34"},{_name:"bulletBlue_outline.png",_x:"755",_y:"300",_width:"20",_height:"34"},{_name:"bulletGreen.png",_x:"24",_y:"481",_width:"12",_height:"26"},{_name:"bulletGreenSilver.png",_x:"36",_y:"481",_width:"12",_height:"26"},{_name:"bulletGreenSilver_outline.png",_x:"691",_y:"140",_width:"20",_height:"34"},{_name:"bulletGreen_outline.png",_x:"168",_y:"345",_width:"20",_height:"34"},{_name:"bulletRed.png",_x:"120",_y:"481",_width:"12",_height:"26"},{_name:"bulletRedSilver.png",_x:"60",_y:"481",_width:"12",_height:"26"},{_name:"bulletRedSilver_outline.png",_x:"711",_y:"140",_width:"20",_height:"34"},{_name:"bulletRed_outline.png",_x:"735",_y:"300",_width:"20",_height:"34"},{_name:"bulletSilver.png",_x:"72",_y:"481",_width:"12",_height:"26"},{_name:"bulletSilverSilver.png",_x:"84",_y:"481",_width:"12",_height:"26"},{_name:"bulletSilverSilver_outline.png",_x:"778",_y:"472",_width:"20",_height:"34"},{_name:"bulletSilver_outline.png",_x:"775",_y:"306",_width:"20",_height:"34"},{_name:"bulletYellow.png",_x:"96",_y:"481",_width:"12",_height:"26"},{_name:"bulletYellowSilver.png",_x:"108",_y:"481",_width:"12",_height:"26"},{_name:"bulletYellowSilver_outline.png",_x:"794",_y:"0",_width:"20",_height:"34"},{_name:"bulletYellow_outline.png",_x:"814",_y:"0",_width:"20",_height:"34"},{_name:"dirt.png",_x:"0",_y:"0",_width:"128",_height:"128"},{_name:"grass.png",_x:"0",_y:"128",_width:"128",_height:"128"},{_name:"oil.png",_x:"200",_y:"408",_width:"96",_height:"96"},{_name:"sand.png",_x:"0",_y:"256",_width:"128",_height:"128"},{_name:"sandbagBeige.png",_x:"128",_y:"301",_width:"66",_height:"44"},{_name:"sandbagBrown.png",_x:"730",_y:"410",_width:"66",_height:"44"},{_name:"smokeGrey0.png",_x:"416",_y:"188",_width:"87",_height:"87"},{_name:"smokeGrey1.png",_x:"296",_y:"408",_width:"92",_height:"89"},{_name:"smokeGrey2.png",_x:"478",_y:"384",_width:"90",_height:"99"},{_name:"smokeGrey3.png",_x:"651",_y:"353",_width:"79",_height:"79"},{_name:"smokeGrey4.png",_x:"128",_y:"97",_width:"100",_height:"97"},{_name:"smokeGrey5.png",_x:"128",_y:"194",_width:"98",_height:"107"},{_name:"smokeOrange0.png",_x:"486",_y:"275",_width:"87",_height:"87"},{_name:"smokeOrange1.png",_x:"324",_y:"196",_width:"92",_height:"89"},{_name:"smokeOrange2.png",_x:"388",_y:"408",_width:"90",_height:"99"},{_name:"smokeOrange3.png",_x:"656",_y:"261",_width:"79",_height:"79"},{_name:"smokeOrange4.png",_x:"0",_y:"384",_width:"100",_height:"97"},{_name:"smokeOrange5.png",_x:"228",_y:"0",_width:"98",_height:"107"},{_name:"smokeWhite0.png",_x:"324",_y:"107",_width:"92",_height:"89"},{_name:"smokeWhite1.png",_x:"396",_y:"285",_width:"90",_height:"99"},{_name:"smokeWhite2.png",_x:"590",_y:"182",_width:"79",_height:"79"},{_name:"smokeWhite3.png",_x:"128",_y:"0",_width:"100",_height:"97"},{_name:"smokeWhite4.png",_x:"226",_y:"194",_width:"98",_height:"107"},{_name:"smokeWhite5.png",_x:"418",_y:"0",_width:"87",_height:"87"},{_name:"smokeYellow0.png",_x:"228",_y:"107",_width:"87",_height:"87"},{_name:"smokeYellow1.png",_x:"326",_y:"0",_width:"92",_height:"89"},{_name:"smokeYellow2.png",_x:"416",_y:"89",_width:"90",_height:"99"},{_name:"smokeYellow3.png",_x:"651",_y:"432",_width:"79",_height:"79"},{_name:"smokeYellow4.png",_x:"100",_y:"384",_width:"100",_height:"97"},{_name:"smokeYellow5.png",_x:"298",_y:"301",_width:"98",_height:"107"},{_name:"tankBeige.png",_x:"730",_y:"340",_width:"75",_height:"70"},{_name:"tankBeige_outline.png",_x:"505",_y:"0",_width:"83",_height:"78"},{_name:"tankBlack.png",_x:"671",_y:"0",_width:"75",_height:"70"},{_name:"tankBlack_outline.png",_x:"568",_y:"362",_width:"83",_height:"78"},{_name:"tankBlue.png",_x:"671",_y:"70",_width:"75",_height:"70"},{_name:"tankBlue_outline.png",_x:"506",_y:"78",_width:"83",_height:"78"},{_name:"tankGreen.png",_x:"669",_y:"182",_width:"75",_height:"70"},{_name:"tankGreen_outline.png",_x:"573",_y:"275",_width:"83",_height:"78"},{_name:"tankRed.png",_x:"568",_y:"440",_width:"75",_height:"70"},{_name:"tankRed_outline.png",_x:"588",_y:"0",_width:"83",_height:"78"},{_name:"tracksLarge.png",_x:"589",_y:"78",_width:"82",_height:"104"},{_name:"tracksSmall.png",_x:"744",_y:"140",_width:"74",_height:"104"},{_name:"treeLarge.png",_x:"200",_y:"301",_width:"98",_height:"107"},{_name:"treeSmall.png",_x:"503",_y:"188",_width:"87",_height:"87"}],_imagePath:"sheet.png"},Bt={TextureAtlas:Lt},A=class{constructor(){_(this,"_sprites");_(this,"_sheetTanks");this._sprites=[],this._sheetTanks=Bt}get sprites(){return this._sprites}static getInstance(){return A.instance||(A.instance=new A),A.instance}load(t,e){return new Promise(n=>{const s=new Image;s.onload=()=>{const o={image:s,type:e};n(o),this._sprites.push(o)},s.src=t})}getSprite(t){return this._sprites.find(e=>e.type===t)}getTexture(t){const e=this._sheetTanks.TextureAtlas.SubTexture.find(n=>n._name===t);if(e)return{...e,name:Number(e==null?void 0:e._name),x:Number(e==null?void 0:e._x),y:Number(e==null?void 0:e._y),w:Number(e==null?void 0:e._width),h:Number(e==null?void 0:e._height)}}};let E=A;_(E,"instance");class Wt extends C{constructor(e,n,s,o){super(e);_(this,"_isMoving");_(this,"_cooldownFire");this.image=e,this._hero=n,this._shots=s,this._camera=o,this._isMoving=!1,this._cooldownFire=!1,this._life=100}get isMoving(){return this._isMoving}set isMoving(e){this._isMoving=e}enterInHeroArea(e){const n=e.x,s=e.y;return Math.sqrt((this.x-n)*(this.x-n)+(this._y-s)*(this._y-s))<e.detectionRadius}shoot(){if(!this._cooldownFire){const e=E.getInstance().getSprite("shell").image,n=this.x+(this._w-e.width)/2,s=this._y+(this._h-e.height)/2,o=new ft(e,this._camera,this._x,this._y).setType("enemy").posX(n).posY(s).width(e.width).height(e.height).setAngle(this.angle).setSpeed(8).setDamage(0).setLife(0);this._shots.push(o),this._cooldownFire=!0,this._isMoving=!1,setTimeout(()=>this._cooldownFire=!1,V(2500,5e3))}}move(){if(this.enterInHeroArea(this._hero)){this._isMoving=!0,this._angle=Math.atan2(this._hero.y+this._hero.h/2-this._y-this._h/2,this._hero.x+this._hero.w/2-this._x-this._w/2);const e=Math.cos(this._angle)*this._speed,n=Math.sin(this._angle)*this._speed;this._x+=e,this._y+=n,this.shoot()}}update(){this.move()}draw(e){const s=e.canvas.width/128,o=e.canvas.height/128,c=Math.abs(this._camera.x/128-this._x/128),p=Math.abs(this._camera.y/128-this._y/128);if(c<=s&&c>=0&&p<=o&&p>=0){this._life/100;const w=this._x-this._camera.x,x=this._y-this._camera.y;e.save(),e.translate(w+this._w/2,x+this._h/2),e.rotate(this._angle),e.translate(-w-this._w/2,-x-this._h/2),e.drawImage(this._image,w,x,this.w,this.h),e.restore()}}}class Z{constructor(t,e){_(this,"_mapCanvas");_(this,"_ctx");_(this,"_gameover");_(this,"_map");_(this,"_heros");_(this,"_enemies");_(this,"_explosions");_(this,"_shots");_(this,"_smokes");_(this,"_camera");this._menu=t,this._spriteProcessor=e,this._mapCanvas=document.querySelector("canvas"),this._ctx=this._mapCanvas.getContext("2d"),this._gameover=!1,this._map=this._spriteProcessor.map,this._heros=this._spriteProcessor.heros,this._enemies=this._spriteProcessor.enemies,this._explosions=this._spriteProcessor.explosions,this._shots=this._spriteProcessor.shots,this._smokes=this._spriteProcessor.smokes,this._camera=this._spriteProcessor.map.camera}static collide(t,e){if(!e||!t)return;const n=t.x-e.x,s=t.y-e.y;return Math.abs(n)<t.w/2+e.w/2&&Math.abs(s)<t.h/2+e.h/2}async load(){this._map.generateRandomMap()&&(this._camera.bind(this._heros[0]),this._mapCanvas.width=window.innerWidth,this._mapCanvas.height=window.innerHeight,this.spawnEnemies(),window.addEventListener("click",()=>{this._heros[0].shot(this._shots,this._smokes)}))}spawnEnemies(){const t=E.getInstance().getSprite("enemy").image;for(let e=0;e<this._menu.settings.nbEnemies;e++){const n=V(0,this._map.mapWidth),s=V(0,this._map.mapHeight),o=new Wt(t,this._heros[0],this._shots,this._camera).posX(n).posY(s).width(t.width).height(t.height).setSpeed(1);this._enemies.push(o)}}showFps(t){this._ctx.fillStyle="White",this._ctx.font="normal 16pt Arial",this._ctx.fillText(Math.round(t)+" fps",20,20)}loop(){this._camera.update(),this._shots.forEach(t=>{t.update(),this._spriteProcessor.shotCollideMap(t),this._enemies.forEach(e=>{this._spriteProcessor.checkHit(t,e,this._heros[0])})}),this._heros.forEach(t=>{t.update(),this._spriteProcessor.checkMapCollision(t)}),this._enemies.forEach(t=>{t.update(),t.isMoving&&this._spriteProcessor.checkMapCollision(t)}),this._spriteProcessor.checkIfSpriteSouldBeDelete()}draw(t){this._ctx.clearRect(0,0,this._mapCanvas.width,this._mapCanvas.height),this._map.drawMap(this._ctx),this._explosions.forEach(e=>e.draw(this._ctx)),this._shots.forEach(e=>e.draw(this._ctx)),this._heros.forEach(e=>e.draw(this._ctx)),this._smokes.forEach(e=>e.draw(this._ctx)),this._enemies.forEach(e=>e.draw(this._ctx)),this.showFps(t)}}class Ft extends C{constructor(e,n,s){super(e);_(this,"_sw");_(this,"_sh");_(this,"_frame");_(this,"_frameCount");_(this,"_smokes");this.image=e,this._camera=n,this._nbFrame=s,this._sw=e.width/8,this._sh=e.height/1,this._frame=0,this._frameCount=0,this._smokes=[{id:0,x:324,y:107,w:92,h:89},{id:1,x:396,y:285,w:90,h:99},{id:2,x:590,y:182,w:79,h:79},{id:3,x:128,y:0,w:100,h:97},{id:4,x:226,y:194,w:98,h:107},{id:5,x:418,y:0,w:87,h:87}]}get nbFrame(){return this._nbFrame}get frame(){return this._frame}update(){}draw(e){const n=this._x-this._camera.x,s=this._y-this._camera.y,o=this._smokes[this._frame].x??0,c=this._smokes[this._frame].y??0,p=this._smokes[this._frame].w??0,w=this._smokes[this._frame].h??0;e.save(),e.translate(n+p/2,s),e.rotate(this._angle-Math.PI/2),e.translate(-n-p/2,-s),this._frameCount++,this._frameCount%2===0&&this._frame++,e.drawImage(this.image,o,c,p,w,Math.round(n+this._frame),Math.round(s+this._frame*20),p,w),e.restore()}}class jt extends C{constructor(e,n,s,o){super(e);_(this,"_angleSpeed");_(this,"_detectionRadius");_(this,"_mouseX");_(this,"_mouseY");_(this,"_canvasRect");this.image=e,this._inputHandler=n,this._barrel=s,this._map=o,this._angleSpeed=2,this._mouseX=0,this._mouseY=0,this._canvasRect=void 0,this._detectionRadius=500;const c=document.querySelector("canvas");c.addEventListener("mousemove",p=>{this._canvasRect=c.getBoundingClientRect(),this._mouseX=p.clientX-this._canvasRect.left+this._map.camera.x,this._mouseY=p.clientY-this._canvasRect.top+this._map.camera.y})}get detectionRadius(){return this._detectionRadius}move(){const e=this._angle*(Math.PI/180),n=Math.sin(e)*this._speed,s=Math.cos(e)*this._speed;this._x+=n,this._y-=s,this._inputHandler.up&&(this._speed+=.04,this._speed>4?this._speed=4:this._speed+=.04),this._inputHandler.left&&(this._angle+=this._angleSpeed),this._inputHandler.right&&(this._angle-=this._angleSpeed),this._inputHandler.up||(this._speed<=0?this._speed=0:this._speed-=.03),(this._angle>360||this._angle<-360)&&(this._angle=0)}shot(e,n){const s=E.getInstance().getTexture("bulletGreenSilver_outline.png");if(!s)return;const o=this._x+this._w/2-s.w/2,c=this._y+this._h/2-s.h/2,p=new ft(this._image,this._map.camera,o,c).setType("hero").posX(o).posY(c).setSx(s.x).setSy(s.y).width(s.w).height(s.h).setAngle(this._barrel.angle).setSpeed(35).setDamage(50);e.push(p);const w=new Ft(this.image,this._map.camera,6).posX(this._barrel.x-this._barrel.w).posY(this._barrel.y).setAngle(this._barrel.angle);n.push(w)}update(){this.move(),this._barrel.attach(this),this._barrel.rotate(this._mouseX,this._mouseY)}draw(e){e.save(),this._life/100;const n=this._x-this._map.camera.x,s=this._y-this._map.camera.y;e.translate(n+this._w/2,s+this._h/2),e.rotate(this._angle*(Math.PI/180)),e.translate(-n-this._w/2,-s-this._h/2),e.drawImage(this.image,this._sx,this._sy,this._w,this._h,n,s,this._w,this._h),e.restore(),this._barrel.draw(e)}}const zt=[{id:0,x:0,y:0,collide:!1,muddy:!0,probability:.1,image:null,w:128,h:128},{id:1,x:0,y:128,collide:!1,muddy:!1,probability:.5,image:null,w:128,h:128},{id:2,x:0,y:256,collide:!1,muddy:!0,probability:.2,image:null,w:128,h:128},{id:3,x:503,y:188,collide:!0,muddy:!1,probability:.1,image:null,w:87,h:87},{id:4,x:200,y:301,collide:!0,muddy:!1,probability:.1,image:null,w:98,h:107}];function Dt(d){const t=Math.random();let e=0;const n=d.length-1;for(let s=0;s<n;s++)if(e+=d[s].probability,t<e)return d[s];return d[n]}class qt{constructor(t,e,n,s){_(this,"_grid");_(this,"_height");_(this,"_width");_(this,"_tileSize");_(this,"_tiles");this._image=n,this._camera=s,this._width=t,this._height=e,this._tileSize=128,this._tiles=[],this._grid=[]}get camera(){return this._camera}get grid(){return this._grid}get height(){return this._height}get width(){return this._width}get tileSize(){return this._tileSize}get mapWidth(){return this._width*this._tileSize}get mapHeight(){return this._height*this._tileSize}generateRandomMap(){for(let e=0;e<this._height;e++){this._grid[e]=[];for(let n=0;n<this._width;n++){const o={...Dt(zt)};this._grid[e].push(o)}}const t=Math.floor(this._grid.length/2);return this._grid[t][t].collide=!1,this._grid}getTile(t,e){return this._grid[t][e]}dynamicMapLoading(){const t=Math.ceil(1920/this._tileSize+1),e=Math.ceil(1080/this._tileSize),n=Math.max(0,Math.floor(this._camera.x/this._tileSize)),s=Math.max(0,Math.floor(this._camera.y/this._tileSize)),o=Math.min(this._width,n+t),c=Math.min(this._height,s+e);return{startX:n,startY:s,endX:o,endY:c}}drawTile(t,e,n,s){e&&t.drawImage(this._image,e.x,e.y,e.w,e.h,Math.round(n),Math.round(s),e.w,e.h)}drawMap(t){const{startX:e,startY:n,endX:s,endY:o}=this.dynamicMapLoading();for(let c=n;c<o;c++)for(let p=e;p<s;p++){const w=this._grid[c][p],x=p*this._tileSize-this._camera.x,S=c*this._tileSize-this._camera.y;switch(w.id){case 3:this.drawTile(t,{x:0,y:128,w:128,h:128},x,S);break;case 4:this.drawTile(t,{x:0,y:128,w:128,h:128},x,S);break}t.drawImage(this._image,w.x,w.y,w.w,w.h,Math.round(x),Math.round(S),w.w,w.h)}}}class Ut{constructor(t){_(this,"_menu");_(this,"_restart");_(this,"_settings");_(this,"_playElem");_(this,"_settingsElem");_(this,"_buttonElem");this._main=t,this._menu=document.querySelector(".menu"),this._playElem=document.querySelector(".play"),this._settingsElem=document.querySelector(".settings"),this._buttonElem=document.querySelector("button"),this._restart=!1,this._settings={mapWidth:50,mapHeight:50,nbEnemies:25},this._playElem.addEventListener("click",this.play.bind(this)),this._settingsElem.addEventListener("click",this.displaySettings.bind(this)),this._buttonElem.addEventListener("click",this.saveSettings.bind(this))}get settings(){return this._settings}get restart(){return this._restart}set restart(t){this._restart=t}async play(){this.hidde(),this.restart||await this._main(),console.log("play"),this._playElem.innerText="Rejouer",this._restart=!0}displaySettings(){const t=document.querySelector(".items");t.style.display="none";const e=document.querySelector(".form-settings");e.style.display="flex"}saveSettings(t){t.preventDefault();const n=t.target.parentElement,s=new FormData(n),o=Object.fromEntries(s);this._settings={mapWidth:Number(o.width),mapHeight:Number(o.height),nbEnemies:Number(o.enemies)},n.style.display="none";const c=document.querySelector(".items");c.style.display="block"}checkVisibility(){return this._menu.style.visibility==="visible"}display(){return this._menu.style.visibility="visible",this}hidde(){return this._menu.style.visibility="hidden",this}}class lt extends C{constructor(e,n,s){super(e);_(this,"_sw");_(this,"_sh");_(this,"_frame");_(this,"_frameCount");this.image=e,this._camera=n,this._nbFrame=s,this._sw=e.width/8,this._sh=e.height/1,this._frame=0,this._frameCount=0}get nbFrame(){return this._nbFrame}set nbFrame(e){this._nbFrame=e}get frame(){return this._frame}update(){}draw(e){const n=this._x-this._camera.x,s=this._y-this._camera.y,o=this._sw*this._frame,c=0;e.drawImage(this.image,o,c,this._sw,this._sh,n,s,this._sw,this._sh),this._frameCount++,this._frameCount%5===0&&this._frame++}}class Nt{constructor(t,e,n,s,o,c){this._heros=t,this._enemies=e,this._shots=n,this._explosions=s,this._smokes=o,this._map=c}get map(){return this._map}get smokes(){return this._smokes}get explosions(){return this._explosions}get shots(){return this._shots}get enemies(){return this._enemies}get heros(){return this._heros}checkHit(t,e,n){t.type==="hero"&&Z.collide(t,e)?this.decreaseLifePoints(e,t):t.type==="enemy"&&Z.collide(t,n)&&this.decreaseLifePoints(n,t)}decreaseLifePoints(t,e){e.isHitted||(t.life-=e.damage,e.isHitted=!0)}checkIfSpriteSouldBeDelete(){var t,e;for(let n=this._enemies.length-1;n>=0;n--){const s=this._enemies[n];if(s.life<=0){const o=(t=E.getInstance().getSprite("explosion"))==null?void 0:t.image,c=new lt(o,this._map.camera,8).posX(s.x-s.w/2).posY(s.y-s.h/2);this._explosions.push(c),this.deleteSprite(n,this._enemies)}}for(let n=this._heros.length-1;n>=0;n--)this._heros[n].life<=0&&this.deleteSprite(n,this._heros);for(let n=this._smokes.length-1;n>=0;n--){const s=this._smokes[n];s.frame>=s.nbFrame-1&&this.deleteSprite(n,this._smokes)}for(let n=this._shots.length-1;n>=0;n--){const s=this._shots[n];if(s.isHitted||s.rangeLimitReached()){const o=new lt((e=E.getInstance().getSprite("explosion2"))==null?void 0:e.image,this._map.camera,8).posX(s.x-s.w/2).posY(s.y-s.h/2);this._explosions.push(o),this.deleteSprite(n,this._shots)}}for(let n=this._explosions.length-1;n>=0;n--){const s=this._explosions[n];s.frame>=s.nbFrame-1&&this.deleteSprite(n,this._explosions)}}deleteSprite(t,e){e.splice(t,1)}saveLastPos(t){t.lastPosX=t.x,t.lastPosY=t.y}reposition(t,e){if(e){t.isHitted=!0;return}t.speed=0,t.x=t.lastPosX,t.y=t.lastPosY}collideWidth(t,e,n,s,o,c){return t.x<e+s-c&&t.x+t.w>e+c&&t.y<n+o-c&&t.h+t.y>n+c}shotCollideMap(t){this.checkMapCollision(t,!0)&&(t.isHitted=!0)}checkMapCollision(t,e=!1){const{startX:n,startY:s,endX:o,endY:c}=this._map.dynamicMapLoading();for(let p=s;p<c;p++)for(let w=n;w<o;w++){const x=this._map.grid[p][w],S=x.w,P=x.h,T=w*this._map.tileSize,H=p*this._map.tileSize,G=30;x.collide&&this.collideWidth(t,T,H,S,P,G)&&this.reposition(t,e),x.muddy}this.checkIfEntityOutsideMap(t,e),this.saveLastPos(t)}checkIfEntityOutsideMap(t,e=!1){return t.x>this._map.mapWidth-t.w&&this.reposition(t,e),t.x<0&&this.reposition(t,e),t.y>this._map.mapHeight-t.h&&this.reposition(t,e),t.y<0&&this.reposition(t,e),!1}}class $t{constructor(){_(this,"_up");_(this,"_right");_(this,"_left");this._up=!1,this._right=!1,this._left=!1,window.addEventListener("keydown",t=>{switch(t.key){case"z":this._up=!0;break;case"q":this._right=!0;break;case"d":this._left=!0;break}}),window.addEventListener("keyup",t=>{switch(t.key){case"z":this._up=!1;break;case"q":this._right=!1;break;case"d":this._left=!1;break}})}get up(){return this._up}set up(t){this._up=t}get right(){return this._right}set right(t){this._right=t}get left(){return this._left}set left(t){this._left=t}}let ut=0,ct=0;const W=[],Vt=60,dt=1e3/Vt,X=new Ut(Jt).display();async function Zt(d,t){await d.load(`${t}/tankE.png`,"enemy"),await d.load(`${t}/obus.png`,"shell"),await d.load(`${t}/tank.png`,"hero"),await d.load(`${t}/treeLarge.png`,"tree"),await d.load(`${t}/explosion.png`,"explosion"),await d.load(`${t}/explosion-2.png`,"explosion2"),await d.load(`${t}/sheet_tanks.png`,"sheetTanks")}async function Jt(){const d=[],t=[],e=[],n=[],s=[],o=window.innerWidth,c=window.innerHeight;console.log(o,c);const p=E.getInstance();await Zt(p,"./assets/images");const w=p.getSprite("sheetTanks").image,x=p.getTexture("tankGreen_outline.png"),S=p.getTexture("barrelGreen_outline.png"),P=new Gt(o,c),T=new qt(X.settings.mapWidth,X.settings.mapHeight,w,P),H=new $t,G=new Ht(w,P).setSx(S.x).setSy(S.y).width(S.w).height(S.h),I=new jt(w,H,G,T).posX(X.settings.mapWidth*128/2).posY(X.settings.mapHeight*128/2).setSx(x.x).setSy(x.y).width(x.w).height(x.h).setSpeed(0);e.push(I);const q=new Nt(e,d,t,n,s,T),L=new Z(X,q);await L.load();async function F(j){const z=j-ut;if(z>=dt){const D=performance.now();W.length>0&&W[0]<=D-1e3&&W.shift(),W.push(D),ct=W.length,X.checkVisibility()||(L.loop(),L.draw(ct)),ut=j-z%dt}requestAnimationFrame(F)}await F(0)}
